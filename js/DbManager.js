var DbManager={db:null,initialise:function(){this.db=openDatabase("p3reader","1.0","Subscriptions Database",204800);this.db.transaction(function(b){b.executeSql("CREATE TABLE IF NOT EXISTS subscriptions(id text PRIMARY KEY, htmlUrl text, title text,label text,unreadCount integer,timestamp DATETIME)",[],function(){},function(){})});this.db.transaction(function(b){b.executeSql("CREATE TABLE IF NOT EXISTS tags(id text,item text PRIMARY KEY,tag text,timestamp DATETIME)",[],function(){},function(){})})},
openDb:function(){this.db=openDatabase("p3reader","1.0","Subscriptions Database",204800)},insertSubscription:function(b,a,c,d){this.db.transaction(function(f){f.executeSql("INSERT INTO subscriptions(id,htmlUrl,title,label,unreadCount,timestamp) VALUES (?,?,?,?,0,?)",[b,a,c,d,new Date],function(){},function(){})})},removeSubscription:function(b,a){this.db.transaction(function(c){c.executeSql("DELETE FROM subscriptions WHERE id = ?",[b],function(){a()},function(){})})},insertTag:function(b,a,c){this.db.transactiohn(function(d){d.executeSql("INSERT INTO tags(id,item,tag,timestamp) VALUES (?,?,?,?)",
[b,a,c,new Date],function(){},function(){})})},getSubscriptions:function(b){this.db.transaction(function(a){a.executeSql("SELECT * FROM subscriptions",[],function(a,d){var f=d.rows.length,e,g=Array(f);for(e=0;e<f;e++)g[e]={},g[e].url=d.rows.item(e).id,g[e].title=d.rows.item(e).title,g[e].label=d.rows.item(e).label,g[e].unreadCount=d.rows.item(e).unreadCount;b(g)})})},getSubscriptionIds:function(b){this.db.transaction(function(a){a.executeSql("SELECT id FROM subscriptions",[],function(a,d){var f=d.rows.length,
e,g=Array(f);for(e=0;e<f;e++)g[e]=d.rows.item(e).id;b&&b(g)})})},checkSubscription:function(b,a){this.db.transaction(function(c){c.executeSql("SELECT * FROM subscriptions WHERE id=?",[b],function(b,c){a&&a(c.rows.length)},function(){})})},getUnreadCount:function(b,a){this.db.transaction(function(c){c.executeSql("SELECT unreadCount FROM subscriptions WHERE id=?",[b],function(b,c){a&&a(c.rows.item(0).unreadCount)},function(){})})},updateUnreadCount:function(b,a){this.db.transaction(function(c){c.executeSql("UPDATE subscriptions SET unreadCount=? WHERE id=?",
[a,b],function(){})})},getItemTag:function(b,a,c){this.db.transaction(function(d){d.executeSql("SELECT tag FROM tags where item = ? AND id = ?",[a,b],function(b,a){c&&(0==a.rows.length?c(null):c(a.rows.item(0).tag))})})},insertItemTag:function(b,a,c){this.db.transaction(function(d){d.executeSql("INSERT INTO tags(id,item,tag,timestamp) VALUES(?,?,?,?)",[b,a,c,new Date],function(){},function(){})})},updateItemTag:function(b,a,c){this.db.transaction(function(d){d.executeSql("UPDATE tags SET tag = ? WHERE id = ? AND item = ?",
[c,b,a],function(){},function(){})})},emptyDatabase:function(b){this.db.transaction(function(a){a.executeSql("DELETE FROM subscriptions",[],function(){b&&b()});a.executeSql("DELETE FROM tags",[],function(){})})},pruneDatabase:function(){var b=new Date;b.setTime(b.getTime()-1296E5);this.db.transaction(function(a){a.executeSql("DELETE FROM tags WHERE timestamp < ?",[b],function(){},function(){})})},syncWithLocalStorage:function(){var b=new LocalStore("myFeeds");if(null!=b){var a=b.get();if(null!=a){var c=
null,d;if(null!=a)for(var a=a.split(","),f=0;f<a.length;f++)c=new LocalStore(a[f]),d=JSON.parse(c.get()),null!=d&&DbManager.insertSubscription(a[f],d.link,d.title,null),c.remove();b.remove()}}}};
